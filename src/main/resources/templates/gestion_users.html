<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Gestion des Utilisateurs ‚Äì CID</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --clr-light: #70A0C8;
      --clr-bg: #073A87;
      --clr-alt1: #F59201;
      --clr-alt2: #F8B629;
      --txt-strong: #fff;
      --sidebar-bg: #e0e0e0;
      --sidebar-text: #333;
      --radius: 10px;
    }
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Inter',sans-serif; }
    body { display:flex; min-height:100vh; background:var(--clr-light); color:#333; }

    .sidebar { width:260px; background:var(--sidebar-bg); display:flex; flex-direction:column; align-items:center; padding:30px 0; box-shadow:2px 0 5px rgba(0,0,0,0.1); }
    .sidebar .logo { width:140px; margin-bottom:40px; }
    .nav-links { list-style:none; width:100%; flex:1; }
    .nav-links a { display:block; padding:15px 30px; color:var(--sidebar-text); text-decoration:none; font-weight:500; transition:background .3s; }
    .nav-links a.active, .nav-links a:hover { background:rgba(0,0,0,0.1); }
    .logout { margin:20px 0; padding:12px 20px; background:linear-gradient(135deg,var(--clr-alt1),var(--clr-alt2)); color:var(--txt-strong); border:none; border-radius:5px; font-weight:700; cursor:pointer; transition:transform .2s; }
    .logout:hover { transform:translateY(-2px); }

    .main { flex:1; padding:40px; overflow-y:auto; background:#f7f9fc; }
    .main h1 { font-size:2rem; color:var(--clr-bg); margin-bottom:10px; }
    .main p.lead { font-size:1rem; margin-bottom:20px; color:#555; }

    .toolbar { display:flex; gap:10px; align-items:center; margin-bottom:30px; }
    .toolbar .search { flex:1; padding:12px 16px; border:1px solid #ccc; border-radius:var(--radius); }
    .toolbar .btn { padding:12px 20px; border:none; border-radius:var(--radius); font-weight:600; cursor:pointer; color:#fff; transition:transform .2s; }
    .btn-search { background:linear-gradient(135deg,var(--clr-bg),var(--clr-light)); }
    .btn-new { background:linear-gradient(135deg,var(--clr-alt1),var(--clr-alt2)); }
    .btn:hover { transform:translateY(-2px); }

    .table-container { background:#fff; padding:20px; border-radius:var(--radius); box-shadow:0 4px 10px var(--shadow-light); overflow-x:auto; margin-bottom:30px; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:14px 18px; text-align:left; }
    th { background:var(--clr-bg); color:#fff; }
    tbody tr:nth-child(even) { background:#f2f2f2; }
    .btn-edit, .btn-delete { padding:6px 12px; border:none; border-radius:6px; font-size:0.9rem; cursor:pointer; color:#fff; text-decoration:none; }
    .btn-edit { background:linear-gradient(135deg,var(--clr-bg),var(--clr-light)); margin-right:5px; }
    .btn-delete { background:linear-gradient(135deg,#e74c3c,#c0392b); }

    .form-container { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:1000; }
    .form-container.open { display:flex; }
    .form-add { background:#fff; padding:30px; border-radius:var(--radius); box-shadow:0 8px 30px var(--shadow-light); width:90%; max-width:500px; position:relative; }
    .form-add h2 { margin-bottom:20px; color:var(--clr-bg); }
    .form-group { margin-bottom:15px; }
    .form-group label { display:block; margin-bottom:5px; font-weight:600; color:#333; }
    .form-group input, .form-group select { width:100%; padding:12px 16px; border:1px solid #ccc; border-radius:var(--radius); }
    .form-actions { display:flex; gap:10px; margin-top:10px; }
    .btn-submit { flex:1; padding:12px; border:none; border-radius:var(--radius); background:linear-gradient(135deg,var(--clr-alt1),var(--clr-alt2)); color:#fff; font-weight:600; }
    .btn-cancel { flex:1; padding:12px; border:none; border-radius:var(--radius); background:#ccc; color:#333; }
  </style>
</head>
<body>

<aside class="sidebar">
  <img th:src="@{/logo.png}" alt="Logo CID" class="logo"/>
  <ul class="nav-links">
    <li><a href="/admin-dashboard">Tableau de bord</a></li>
    <li><a href="/gestion-users" class="active">Utilisateurs</a></li>
    <li><a href="/consultation-archive">Archives</a></li>
    <li><a href="/consultation-biblio">Biblioth√®que</a></li>
  </ul>
  <button class="logout">D√©connexion</button>
</aside>

<main class="main">
  <h1>G√©rer les utilisateurs</h1>
  <p class="lead">Cr√©ez, modifiez ou supprimez des comptes utilisateur.</p>

  <!-- üîé Barre recherche + bouton -->
  <form th:action="@{/gestion-users/search}" method="get" class="toolbar">
    <input type="text" name="keyword" class="search" placeholder="Rechercher un utilisateur‚Ä¶"/>
    <button type="submit" class="btn btn-search">Rechercher</button>
    <button type="button" id="btn-new" class="btn btn-new" onclick="openForm()">+ Nouvel utilisateur</button>
  </form>

  <!-- üìã Tableau des utilisateurs -->
  <div class="table-container">
    <table>
      <thead>
      <tr>
        <th>ID</th><th>Nom</th><th>Email</th><th>R√¥le</th><th>Division</th><th>P√¥le</th><th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="user : ${users}">
        <td th:text="${user.id}"></td>
        <td th:text="${user.nom + ' ' + user.prenom}"></td>
        <td th:text="${user.email}"></td>
        <td th:text="${user.role}"></td>
        <td th:text="${user.nomDivision}"></td>
        <td th:text="${user.nomPole}"></td>
        <td>
          <a th:href="@{'/gestion-users/edit/' + ${user.id}}" class="btn-edit">Modifier</a>
          <a th:href="@{'/gestion-users/delete/' + ${user.id}}" class="btn-delete"
             onclick="return confirm('Voulez-vous vraiment supprimer cet utilisateur ?')">Supprimer</a>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</main>

<!-- ‚ûï Modal ajout utilisateur -->
<div class="form-container" id="form-container">
  <div class="form-add">
    <button class="close" onclick="closeForm()">&times;</button>
    <h2>Ajouter un utilisateur</h2>
    <form th:action="@{/gestion-users}" th:object="${newUser}" method="post">
      <div class="form-group">
        <label for="nom">Nom</label>
        <input id="nom" type="text" th:field="*{nom}"/>
      </div>
      <div class="form-group">
        <label for="prenom">Pr√©nom</label>
        <input id="prenom" type="text" th:field="*{prenom}"/>
      </div>
      <div class="form-group">
        <label for="email">Adresse e-mail</label>
        <input id="email" type="email" th:field="*{email}"/>
      </div>
      <div class="form-group">
        <label for="role">R√¥le</label>
        <select id="role" th:field="*{role}">
          <option value="">-- S√©lectionner un r√¥le --</option>
          <option th:each="r : ${roles}" th:value="${r}" th:text="${r}"></option>
        </select>
      </div>

      <div class="form-group">
        <label for="pole">P√¥le</label>
        <select id="pole" th:field="*{nomPole}">
          <option value="">-- S√©lectionner un p√¥le --</option>
          <option th:each="p : ${poles}" th:value="${p}" th:text="${p}"></option>
        </select>
      </div>

      <div class="form-group">
        <label for="division">Division</label>
        <select id="division" th:field="*{nomDivision}">
          <option value="">-- S√©lectionner une division --</option>
          <option th:each="d : ${divisions}" th:value="${d}" th:text="${d}"></option>
        </select>
      </div>

      <div class="form-group">
        <label for="password">Mot de passe</label>
        <input id="password" type="password" th:field="*{password}"/>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-submit">Enregistrer</button>
        <button type="button" class="btn-cancel" onclick="closeForm()">Annuler</button>
      </div>
    </form>
  </div>
</div>

<script>
  function openForm() { document.getElementById("form-container").classList.add("open"); }
  function closeForm() { document.getElementById("form-container").classList.remove("open"); }

  document.querySelector('.logout').addEventListener('click', function () {
    window.location.href = '/login';
  });
</script>

</body>
</html>
